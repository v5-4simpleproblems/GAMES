<!DOCTYPE html>
<html lang="en">
<head>
    <title>4SP - STRONGDOG</title>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
    <link rel="icon" type="image/x-icon" href="img/favicon.ico" id="faviconLink" />
    <style>
        /* --- 1. Global Styles & Variables --- */
        @font-face {
            font-family: 'primary';
            src: url('fonts/primary.woff') format('woff');
        }

        :root {
            --red: rgb(220, 53, 69);
            --green: rgb(40, 167, 69);
            --ff: 'primary', sans-serif;
            --bg: #2e2e2e;
            --purple: #6720BD;
        }

        body {
            font-family: var(--ff);
            margin: 0;
            padding: 0 0 100px 0;
            background-color: var(--bg);
            overflow-x: hidden;
        }

        h2 {
            text-align: center;
            color: white;
            margin: 40px 0;
            font-size: 2.5rem;
            text-shadow: none;
        }

        /* --- 2. Utility & State Classes --- */
        /* These classes are toggled by JavaScript to manage the state of elements. */
        /* This is far more durable than manipulating inline styles directly. */
        .is-hidden {
            display: none !important;
        }

        .slide-menu.is-open {
            transform: translateX(0);
        }

        .overlay.is-open {
            display: flex;
        }
        
        /* Class for the link in the welcome message, moved from an inline style */
        .link--highlight {
            color: var(--purple);
            font-weight: bold;
            text-decoration: none;
        }

        /* --- 3. Components: Navbar --- */
        .navbar {
            background-color: rgba(50, 50, 50, 0.9);
            backdrop-filter: blur(10px);
            color: white;
            padding: 15px 30px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.5);
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .logo {
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
            font-weight: 700;
            font-size: 2.5rem;
            letter-spacing: 1px;
            transition: transform 0.3s ease;
            text-decoration: none;
            color: white;
        }

        .logo:hover {
            transform: translateX(-50%) scale(1.025);
        }

        .logo .xp {
            color: var(--purple);
            text-shadow: 0 0 10px rgba(103, 32, 189, 0.5);
        }

        .menu-icon {
            font-size: 2.5rem;
            cursor: pointer;
            color: white;
            transition: transform 0.3s ease, color 0.3s ease;
            /* Reset button styles to make it look like the original div */
            background: none;
            border: none;
            padding: 0;
            font-family: inherit;
        }

        .menu-icon:hover {
            transform: scale(1.2);
        }

        .navbar-right {
            /* Placeholder to keep the logo perfectly centered */
            width: 275px; 
        }

        /* --- 4. Components: Slide Menu --- */
        .slide-menu {
            position: fixed;
            top: 0;
            left: 0;
            height: 100vh;
            width: 400px;
            backdrop-filter: blur(10px);
            color: white;
            box-shadow: 5px 0 20px rgba(0, 0, 0, 0.7);
            z-index: 1003;
            transition: transform 0.5s ease;
            /* Default state is hidden to the left */
            transform: translateX(-100%);
            padding: 20px;
            overflow-y: auto;
            box-sizing: border-box;
            scrollbar-width: none;
            -ms-overflow-style: none;
            background: linear-gradient(to bottom right, rgba(43, 43, 43, 0.599), rgba(53, 53, 53, 0.599), rgba(80, 80, 80, 0.599));
        }

        .slide-menu::-webkit-scrollbar {
            display: none;
        }

        .categories {
            display: flex;
            flex-direction: column;
            gap: 15px;
            padding-top: 20px;
        }

        .categories>a {
            padding: 17px;
            background: linear-gradient(45deg, #333, #444);
            border-radius: 15px;
            text-decoration: none;
            color: white;
            transition: transform 0.4s ease, background 0.4s ease, box-shadow 0.4s ease;
            text-align: center;
            font-size: 1.2rem;
            position: relative;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        }

        .categories>a:hover {
            background: linear-gradient(45deg, #6720BD, #8a2be2);
            box-shadow: 0 6px 20px rgba(103, 32, 189, 0.5);
        }

        .categories>a::after {
            content: "";
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            border-radius: 50%;
            width: 0;
            height: 0;
            background: rgba(0, 0, 0, 0.1);
            transition: all 0.5s ease;
        }

        .categories>a:hover::after {
            width: 500px;
            height: 500px;
        }

        /* --- 5. Components: Game Grid & Cards --- */
        .games-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
            gap: 25px;
            padding: 20px;
            max-width: 1600px;
            margin: 0 auto;
        }

        /* Renamed .zone-item to .game-card for better semantics */
        .game-card {
            background-color: #3a3a3a;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.4);
            cursor: pointer;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            position: relative;
            overflow: hidden;
            aspect-ratio: 4 / 3;
        }
        
        .game-card img.game-cover {
            width: 100%; height: 100%; object-fit: cover;
            border-radius: 12px;
            transition: transform 0.4s ease-in-out;
        }
        
        .game-card .card-overlay {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(to top, rgba(15, 15, 25, 0.9) 0%, rgba(20, 20, 30, 0.5) 50%, transparent 100%);
            display: flex;
            flex-direction: column;
            justify-content: flex-end;
            padding: 15px;
            opacity: 0;
            transform: translateY(15px);
            transition: opacity 0.3s ease, transform 0.3s ease;
            box-sizing: border-box;
            color: #fff;
        }

        .game-card:hover {
            transform: translateY(-5px) scale(1.03);
            box-shadow: 0 8px 30px rgba(103, 32, 189, 0.4);
        }
        .game-card:hover .game-cover {
            transform: scale(1.1);
        }
        .game-card:hover .card-overlay {
            opacity: 1;
            transform: translateY(0);
        }

        .game-card .game-title {
            font-family: var(--ff);
            font-size: 1.1em;
            font-weight: bold;
            margin: 0 0 10px 0;
            line-height: 1.3;
            text-shadow: 1px 1px 5px rgba(0,0,0,0.7);
        }

        .game-card .card-buttons {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        
        .game-card .card-play-btn, .game-card .favorite-btn {
            border: none;
            border-radius: 8px;
            height: 38px;
            cursor: pointer;
            transition: background-color 0.2s ease, transform 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .game-card .card-play-btn {
            flex-grow: 1;
            background-color: rgba(255, 255, 255, 0.9);
            color: #6720bd;
            font-weight: bold;
            font-family: var(--ff);
        }
        .game-card .card-play-btn:hover {
            background-color: #fff;
            transform: scale(1.05);
        }

        .game-card .favorite-btn {
            width: 38px;
            background-color: rgba(255, 255, 255, 0.2);
            flex-shrink: 0;
        }
        .game-card .favorite-btn:hover {
            background-color: rgba(255, 255, 255, 0.35);
        }
        .game-card .favorite-btn img {
            width: 20px;
            height: 20px;
            transition: filter 0.3s ease, transform 0.3s ease;
        }

        .game-card .favorite-btn.favorited img {
            filter: brightness(0) invert(1) drop-shadow(0 0 6px #ffc107) drop-shadow(0 0 10px #ff8c00);
            transform: scale(1.1);
        }

        /* --- 6. Components: Bottom Search Bar --- */
        .bottom-search-bar {
            position: fixed;
            bottom: 15px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 1001;
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 10px;
            background: linear-gradient(135deg, rgba(50, 50, 50, 0.2), rgba(30, 30, 30, 0.1));
            backdrop-filter: blur(8px) saturate(1.5);
            -webkit-backdrop-filter: blur(8px) saturate(1.5);
            border-radius: 20px;
            border: 1px solid rgba(255, 255, 255, 0.15);
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.25), inset 0 1px 1px 0 rgba(255, 255, 255, 0.1);
            width: 90%;
            max-width: 450px;
            box-sizing: border-box;
        }
        .bottom-search-bar input[type="text"] {
            background: transparent;
            border: none;
            border-bottom: 1px solid rgba(255,255,255,0.4);
            border-radius: 0;
            color: #fff;
            padding: 8px 5px;
            font-size: 1em;
            outline: none;
            font-family: var(--ff);
            flex-grow: 1;
            width: auto;
        }
        .bottom-search-bar input[type="text"]::placeholder {
            color: rgba(255, 255, 255, 0.6);
        }
        .search-results {
            position: absolute;
            bottom: 100%;
            left: 0; /* Changed from right: 0 to align with the parent */
            width: 100%;
            margin-bottom: 10px;
            background: linear-gradient(135deg, rgba(55, 55, 55, 0.4), rgba(40, 40, 40, 0.3));
            backdrop-filter: blur(8px) saturate(1.5);
            -webkit-backdrop-filter: blur(8px) saturate(1.5);
            border: 1px solid rgba(255, 255, 255, 0.15);
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.8);
            border-radius: 15px;
            display: none;
            overflow: hidden;
            z-index: 1000;
            max-height: 350px;
            overflow-y: auto;
        }
        
        .search-results::-webkit-scrollbar { width: 8px; }
        .search-results::-webkit-scrollbar-track { background: rgba(0,0,0,0.2); border-radius: 4px; }
        .search-results::-webkit-scrollbar-thumb { background-color: rgba(255,255,255,0.3); border-radius: 4px; }
        .search-results::-webkit-scrollbar-thumb:hover { background-color: rgba(255,255,255,0.5); }
        .search-results a {
            display: flex;
            align-items: center;
            text-decoration: none;
            color: white;
            padding: 10px;
            transition: all 0.3s ease;
            border-bottom: 1px solid rgba(255, 255, 255, 0.15);
        }
        .search-results a:focus,
        .search-results a:hover {
            outline: none;
            background: rgba(80, 80, 80, 0.7);
            padding-left: 15px;
        }
        .search-results img {
            width: 60px;
            height: 60px;
            object-fit: cover;
            margin-right: 15px;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.3);
        }
        .search-results a:last-child {
            border-bottom: none;
        }

        /* --- 7. Components: Other UI Elements --- */
        .updates-container {
            margin: 0 20%;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .updates-paragraph-text {
            color: black;
            background: linear-gradient(156deg, #d1c4e9, #e6e6fa, #d8bfd8, #e0b0ff);
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 10px 25px rgba(209, 196, 233, 0.5);
            font-size: 1.1rem;
            text-align: center;
            max-width: 850px;
            margin-block: 20px;
        }

        .overlay {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background-color: rgba(0, 0, 0, 0.75);
            backdrop-filter: blur(5px);
            z-index: 2000;
            display: none; /* Initially hidden */
            justify-content: center;
            align-items: flex-start;
            padding-top: 15vh;
        }
        .popup {
            background: #3a3a3a;
            color: white;
            padding: 25px 35px;
            border-radius: 15px;
            width: 90%;
            max-width: 550px;
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.6);
            position: relative;
            border: 1px solid #555;
        }
        .popup-close {
            position: absolute; top: 10px; right: 15px;
            font-size: 2.5rem; color: #ccc;
            cursor: pointer;
            transition: color 0.3s ease, transform 0.3s ease;
            /* Reset button styles */
            background: none; border: none; padding: 0;
        }
        .popup-close:hover {
            color: white;
            transform: scale(1.1);
        }
        .popup h3 {
            text-align: center;
            font-size: 2rem;
            margin-top: 0;
            margin-bottom: 25px;
            border-bottom: 2px solid var(--purple);
            padding-bottom: 10px;
        }

        /* --- 8. Media Queries --- */
        @media (max-width: 768px) {
            .navbar { flex-wrap: wrap; padding: 10px 15px; }
            .menu-icon { font-size: 2rem; }
            .logo { font-size: 1.8rem; }
            .slide-menu { width: 250px; }
            .categories>a { font-size: 1rem; padding: 15px; }
            .games-grid { gap: 15px; padding: 15px; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); }
            .bottom-search-bar { width: calc(100% - 30px); left: 15px; right: 15px; transform: none; }
            .updates-container { margin: 0 5%; }
        }
    </style>
</head>
<body>
    <header class="navbar">
        <button class="menu-icon" id="menuIcon" type="button" aria-label="Toggle Menu">☰</button>
        <a href="index.html" class="logo">strongdog<span class="xp">XP</span></a>
        <div class="navbar-right"></div> 
    </header>

    <main>
        <section class="updates-container">
            <p class="updates-paragraph-text">
                <strong>Welcome to StrongdogXP!</strong><br>
                This website is being hosted by <a href="https://4simpleproblems.github.io/" class="link--highlight" target="_blank">4SP</a>. I have fixed
                several bugs, and have worked with StrongdogXP to have this connected to my website. So yeah, go nuts.
            </p>
        </section>

        <section id="favoritesSection" class="is-hidden">
             <h2><strong>Favorites</strong></h2>
             <div class="games-grid" id="favoritesGameList"></div>
        </section>

        <section>
            <h2><strong>All Games</strong></h2>
            <div class="games-grid" id="allGamesList"></div>
        </section>
    </main>

    <nav class="slide-menu" id="slideMenu">
        <div class="categories">
            <a href="https://4simpleproblems.github.io/logged-in/games.html" class="option-link">Back to 4SP</a>
            <a href="#" id="openBlank" class="option-link">Open in about:blank</a>
            <a href="./save/index.html" class="option-link">Save manager</a>
            <a href="https://discord.gg/dyyebUaqRS" class="option-link">Discord Server</a>
            <a href="#" id="creditsBtn" class="option-link">Credits</a>
        </div>
    </nav>
    
    <footer class="bottom-search-bar">
        <input type="text" id="searchInput" placeholder="Search for games…" autocomplete="off" />
        <div class="search-results" id="searchResults"></div>
    </footer>
    
    <div id="credits-overlay" class="overlay">
        <div id="credits-popup" class="popup">
            <button id="closeCreditsPopup" class="popup-close" aria-label="Close Credits">&times;</button>
            <h3>Credits</h3>
            <div class="credit-person"><h4>John P - Creator of StrongdogXP</h4><p>He downloaded, compiled and created Strongdog entirely.</p></div>
            <div class="credit-person"><h4>4SP</h4><p>Converted file directories to work with the website, fixed many bugs, and polished up the design.</p></div>
        </div>
    </div>
    
    <script type="module">
        import games from "./cards-data.js";

        // --- 1. DOM Element Connections ---
        // Grouping all DOM queries at the top makes the script easier to read and manage.
        const allGamesList = document.getElementById("allGamesList");
        const favoritesSection = document.getElementById("favoritesSection");
        const favoritesGameList = document.getElementById("favoritesGameList");
        const searchInput = document.getElementById("searchInput");
        const searchResults = document.getElementById("searchResults");
        const menuIcon = document.getElementById("menuIcon");
        const slideMenu = document.getElementById("slideMenu");
        const openBlankLink = document.getElementById("openBlank");
        const creditsBtn = document.getElementById('creditsBtn');
        const creditsOverlay = document.getElementById('credits-overlay');
        const closeCreditsPopup = document.getElementById('closeCreditsPopup');

        // --- 2. State Management (Favorites) ---
        const FAVORITES_KEY = 'strongdogXPFavorites_v2';
        const getFavorites = () => JSON.parse(localStorage.getItem(FAVORITES_KEY)) || [];
        const saveFavorites = (favs) => localStorage.setItem(FAVORITES_KEY, JSON.stringify(favs));
        
        function toggleFavorite(gameId) {
            let favorites = getFavorites();
            const isFavorited = favorites.includes(gameId);

            if (isFavorited) {
                favorites = favorites.filter(id => id !== gameId);
            } else {
                favorites.push(gameId);
            }
            saveFavorites(favorites);

            // Update all visible cards for this game (in both lists)
            document.querySelectorAll(`.game-card[data-game-id='${gameId}'] .favorite-btn`).forEach(btn => {
                btn.classList.toggle('favorited', !isFavorited);
            });
            
            renderFavorites();
        }

        // --- 3. URL and Path Helpers (No changes needed here) ---
        function getPageNumberFromURL(url) { const regex = /(strongdog|mathcord|stroongdog)(\d*)/; const match = url.match(regex); if (match) return match[2] === "" ? 1 : parseInt(match[2], 10); return 1; }
        const siteMapping = window.siteMapping || {};
        function getCurrentSiteKey() { const currentURL = window.location.href; const keys = Object.keys(siteMapping).sort((a, b) => b.length - a.length); for (const k of keys) { if (currentURL.includes(k)) return k; } return null; }
        function getAdjustedUrls(href, imgSrc, page) {
            let adjustedImgSrc = `./img/${imgSrc}`; let currentSiteKey = getCurrentSiteKey();
            if (currentSiteKey) {
                const currentPageNumber = getPageNumberFromURL(currentSiteKey);
                if (page !== undefined && page !== currentPageNumber) {
                    let newBase = window.location.origin + `/strongdog${page}`;
                    adjustedImgSrc = `${newBase}/img/${imgSrc.replace(/^\.\//, "")}`;
                }
            } else if (page !== undefined && page > 1) {
                const newBase = `${window.location.origin}/strongdog${page}`;
                adjustedImgSrc = `${newBase}/img/${imgSrc.replace(/^\.\//, "")}`;
            }
            return { adjustedImgSrc };
        }

        // --- 4. UI Rendering ---
        function createGameCard(game) {
            const { href, imgSrc, name, page, id } = game;
            const { adjustedImgSrc } = getAdjustedUrls(href, imgSrc, page);
            const favorites = getFavorites();

            // Create an <article> element for better semantics
            const cardElement = document.createElement("article");
            cardElement.className = "game-card";
            cardElement.dataset.gameId = id;
            
            cardElement.addEventListener('click', (e) => {
                // Only navigate if not clicking a button inside the card
                if (e.target.closest('button')) return;
                window.location.href = `./play/?id=${id}`;
            });

            const isFavorited = favorites.includes(id);
            // Using innerHTML for efficient creation of the card's content
            cardElement.innerHTML = `
                <img class="game-cover" src="${adjustedImgSrc}" alt="${name}" loading="lazy" onerror="this.onerror=null;this.src='./img/favicon.ico';this.style.objectFit='contain';">
                <div class="card-overlay">
                    <h3 class="game-title">${name}</h3>
                    <div class="card-buttons">
                        <button class="card-play-btn">PLAY</button>
                        <button class="favorite-btn ${isFavorited ? 'favorited' : ''}" aria-label="Toggle Favorite">
                            <img src="images/star-dark.png" alt="Favorite Star">
                        </button>
                    </div>
                </div>
            `;
            
            // Add event listeners to the buttons after they are created
            cardElement.querySelector('.card-play-btn').addEventListener('click', (e) => {
                 e.stopPropagation(); window.location.href = `./play/?id=${id}`; 
            });
            cardElement.querySelector('.favorite-btn').addEventListener('click', (e) => {
                 e.stopPropagation(); toggleFavorite(id); 
            });

            return cardElement;
        }

        function renderGames(gamesToRender, targetElement) {
            targetElement.innerHTML = ''; // Clear previous content
            const fragment = document.createDocumentFragment();
            gamesToRender.forEach(game => {
                fragment.appendChild(createGameCard(game));
            });
            targetElement.appendChild(fragment);
        }

        function renderFavorites() {
            const favoriteIds = getFavorites();
            if (favoriteIds.length > 0) {
                favoritesSection.classList.remove('is-hidden'); // Show section
                const favoriteGames = games.filter(game => favoriteIds.includes(game.id));
                renderGames(favoriteGames, favoritesGameList);
            } else {
                favoritesSection.classList.add('is-hidden'); // Hide section
            }
        }
        
        // Debounce function for performance
        function debounce(func, delay) {
            let timeout;
            return function(...args) {
                clearTimeout(timeout);
                timeout = setTimeout(() => func.apply(this, args), delay);
            };
        }

        const updateSearchResults = debounce(() => {
            const text = searchInput.value.toLowerCase().trim();
            
            // Filter the main grid of all games
            const filteredAllGames = text ? games.filter(g => g.name.toLowerCase().includes(text)) : games;
            renderGames(filteredAllGames, allGamesList);

            // Update the dropdown search results panel
            const filteredDropdown = text ? games.filter(g => g.name.toLowerCase().includes(text)).slice(0, 7) : [];
            searchResults.innerHTML = "";
            if (filteredDropdown.length === 0 || !text) {
                searchResults.style.display = "none";
                return;
            }
            filteredDropdown.forEach(game => {
                const { id, imgSrc, name, page } = game;
                const { adjustedImgSrc } = getAdjustedUrls(game.href, imgSrc, page);
                const linkEl = document.createElement("a");
                linkEl.href = `./play/?id=${id}`;
                linkEl.innerHTML = `<img src="${adjustedImgSrc}" alt="${name}"><span>${name}</span>`;
                searchResults.appendChild(linkEl);
            });
            searchResults.style.display = "block";
        }, 250);

        // --- 5. Event Handlers & Initialization ---
        // This single DOMContentLoaded listener is the entry point for the application.
        document.addEventListener('DOMContentLoaded', () => {
            // Initial render
            renderGames(games, allGamesList);
            renderFavorites();
            searchInput.placeholder = `Search ${games.length} games...`;

            // Menu interactions
            menuIcon.addEventListener("click", ev => {
                ev.stopPropagation();
                slideMenu.classList.toggle('is-open');
            });

            // Credits popup interactions
            creditsBtn.addEventListener('click', (e) => {
                e.preventDefault();
                slideMenu.classList.remove('is-open'); // Close menu if open
                creditsOverlay.classList.add('is-open');
            });
            
            const closePopup = () => creditsOverlay.classList.remove('is-open');
            closeCreditsPopup.addEventListener('click', closePopup);
            creditsOverlay.addEventListener('click', (e) => {
                // Close if clicking on the overlay itself, not the popup content
                if (e.target === creditsOverlay) closePopup();
            });

            // Search interactions
            searchInput.addEventListener("input", updateSearchResults);
            searchInput.addEventListener("focus", updateSearchResults);
            
            // "Open in about:blank" functionality
            openBlankLink?.addEventListener("click", ev => {
                ev.preventDefault();
                const newTab = window.open();
                if (newTab) newTab.document.write(`<html><body style="margin:0;height:100vh;"><iframe src="${window.location.href}" style="border:none;width:100%;height:100%"></iframe></body></html>`);
            });

            // Global click listener to close menus
            document.addEventListener("click", ev => {
                // Close slide menu if clicking outside of it
                if (!slideMenu.contains(ev.target) && !menuIcon.contains(ev.target)) {
                    slideMenu.classList.remove('is-open');
                }
                // Close search results if clicking outside the search bar
                if (!searchInput.parentElement.contains(ev.target)) {
                    searchResults.style.display = "none";
                }
            });
        });
    </script>

    <script src="/firebase-config.js" defer></script>
    <script src="/ban-enforcer.js" defer></script>
    <script src="/url-changer.js" defer></script>
    <script src="/panic-key.js" defer></script>
</body>
</html>
